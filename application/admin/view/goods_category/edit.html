{extend name="Public:common" /}{block name="content"}<div class="layui-fluid"><div class="layui-row layui-col-space15"><div class="layui-col-md12"><div class="layui-card"><div class="layui-card-body">    <fieldset class="layui-elem-field layui-field-title">        <legend>{:lang('edit')}{:lang('goodscategory')}</legend>    </fieldset>    <form class="layui-form layui-form-pane">        <input TYPE="hidden" name="id" value="{$row.id}">                <div class="layui-form-item">            <label class="layui-form-label">上级分类</label>            <div class="layui-input-block">                <select name="parentid" id="parentid">                    <option value="">作为一级分类</option>                    {$categorys}                </select>            </div>        </div>        <div class="layui-form-item">            <label class="layui-form-label">分类名称</label>            <div class="layui-input-block">                <input type="text" name="catname" lay-verify="required" value="{$row.catname}" placeholder="{:lang('pleaseEnter')}分类名称" class="layui-input">            </div>            <div class="layui-form-mid layui-word-aux red">*</div>        </div>               <div class="layui-form-item">            <label class="layui-form-label">分类图片</label>            <input type="hidden" name="image" id="image" value="{$row['image']}">            <div class="layui-input-block">                <div class="layui-upload">                    <button type="button" class="layui-btn layui-btn-primary" id="cateBtn"><i class="icon icon-upload3"></i>点击上传</button>                    <div class="layui-upload-list">                        <img class="layui-upload-img" src="{$row['imgUrl']}" id="cateImage">                        <p id="demoText"></p>                    </div>                </div>            </div>        </div>               <div class="layui-form-item">            <div class="layui-input-block">                <button type="button" class="layui-btn" lay-submit="" lay-filter="submit">{:lang('submit')}</button>                <a href="{:url('index')}" class="layui-btn layui-btn-primary">{:lang('back')}</a>            </div>        </div>    </form></div></div></div></div></div>{/block}{block name="js"}<script>    var datas = "<option value=''>请选择</option>";    var image = '{$row.image}';    layui.use(['form','upload'], function () {        var form = layui.form,upload = layui.upload;        var uploadInst = upload.render({            elem: '#cateBtn'            ,url: '{:url("UpFiles/upload")}',            done: function(res){                if(res.code>0){                    $('#image').val(res.url);                    $('#cateImage').attr('src', res.url);                }else{                    return layer.msg('上传失败');                }            },            error: function(){                //演示失败状态，并实现重传                var demoText = $('#demoText');                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');                demoText.find('.demo-reload').on('click', function(){                    uploadInst.upload();                });            }        });        form.on('submit(submit)', function (data) {            // 提交到方法 默认为本身            var loading = layer.load(1, {shade: [0.1, '#fff']});            $.post("{:url('edit')}", data.field, function (res) {                layer.close(loading);                if (res.code > 0) {                    layer.msg(res.msg, {time: 1800, icon: 1}, function () {                        location.href = res.url;                    });                } else {                    layer.msg(res.msg, {time: 1800, icon: 2});                }            });        });        form.on('select(moduleid)', function(data){            showtemplist(data.value,0,form);        });    });</script>{/block}