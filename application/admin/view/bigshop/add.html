{extend name="Public:common" /}{block name="css"}<style>    .layui-upload-img { width: 90px; height: 90px; margin: 0; }    .pic-more { width:100%; left; margin: 10px 0px 0px 0px;}    .pic-more li { width:90px; float: left; margin-right: 5px;}    .pic-more li .layui-input { display: initial; }    .pic-more li a { position: absolute; top: 0; display: block; }    .pic-more li a i { font-size: 24px; background-color: #008800; }    .pic-more-upload-list .item_img img{ width: 90px; height: 90px;}    .pic-more-upload-list li{position: relative;}    .pic-more-upload-list li .operate{ color: #000; display: none;}    .pic-more-upload-list li .toleft{ position: absolute;top: 40px; left: 1px; cursor:pointer;}    .pic-more-upload-list li .toright{ position: absolute;top: 40px; right: 1px;cursor:pointer;}    .pic-more-upload-list li .close{position: absolute;top: 5px; right: 5px;cursor:pointer;}    .pic-more-upload-list li:hover .operate{ display: block;}</style>{/block}{block name="content"}<div class="layui-fluid"><div class="layui-fluid"><div class="layui-row layui-col-space15"><div class="layui-col-md12"><div class="layui-card"><div class="layui-card-body">        <fieldset class="layui-elem-field layui-field-title">            <legend>添加商圈</legend>        </fieldset>        <form class="layui-form" method="post" enctype="multipart/form-data">            <div class="layui-form-item">                <label class="layui-form-label">商圈名称</label>                <div class="layui-input-block">                    <input type="text" name="name" lay-verify="required" autocomplete="off" placeholder="请输入商圈名称" class="layui-input">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">商家商标logo</label>                <div class="layui-input-block">                    <div class="upload-picture">                        <img src="IMG/upload_200_150.jpg" width="200" height="150" class="preview-picture" onerror="javascript:this.src='IMG/upload_200_150.jpg';">                    </div>                    <input type="hidden" name="bigshoplogo" value="">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">简介</label>                <div class="layui-input-block">                    <input type="text" name="intro" lay-verify="required" autocomplete="off" placeholder="简介" class="layui-input">                </div>            </div>            <div class="layui-form-item layui-form-text">                <label class="layui-form-label">详情介绍</label>                <div class="layui-input-block">                    <textarea placeholder="请输入内容" class="layui-textarea" name="content"></textarea>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">商圈类型</label>                <div class="layui-input-block">                    <select name="type">                        <option value="">请选择商圈类型</option>                        <option value="0">商超</option>                        <option value="1">步行街</option>                    </select>                </div>            </div>            <div class="layui-form-item" id="area-picker">                <div class="layui-form-label">所在地</div>                <div class="layui-input-inline" >                    <select name="province" lay-verify="required" lay-search="" lay-skin="select" lay-filter="province" >                        <option value="">请选择省</option>                        {foreach name="arealist" item="v"}                        <option value="{$v.area_name}" title="{$v.id}">{$v.area_name}</option>                        {/foreach}                    </select>                </div>                <div class="layui-input-inline" >                    <select name="city" lay-verify="required" lay-search="" lay-skin="select" lay-filter="city" id="city">                        <option value="">请选择市</option>                    </select>                </div>                <div class="layui-input-inline" >                    <select name="area" lay-verify="required" lay-search=""lay-skin="select" lay-filter="area" id="area">                        <option value="">请选择县/区</option>                    </select>                </div>                <div class="layui-input-inline" >                    <select name="street" lay-verify="required" lay-search=""lay-skin="select" lay-filter="street" id="street">                        <option value="">请选择镇/街道</option>                    </select>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">详细地址</label>                <div class="layui-input-block">                    <input type="text" name="address" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">                </div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">纬度</label>                    <div class="layui-input-inline">                        <input type="text" id="lat" name="latitude" readonly="readonly" value="{$franchisee.latitude|default=''}" placeholder="请输入纬度" lay-verify="required" autocomplete="off" class="layui-input">                    </div>                </div>                <div class="layui-inline">                    <label class="layui-form-label">经度</label>                    <div class="layui-input-inline">                        <input type="tel" id="lng" placeholder="请输入经度"  readonly="readonly" value="{$franchisee.longitude|default=''}" name="longitude" lay-verify="required" autocomplete="off" class="layui-input">                    </div>                     <div class="layui-input-inline">                    <a href="javascript:;" class="layui-btn mapkg">打开地图选择</a>                    </div>                </div>                <div id="g-map" style="height: 500px;display: none"></div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">电话</label>                    <div class="layui-input-inline">                        <input type="tel" name="phone" lay-verify="required|phone" autocomplete="off" class="layui-input">                    </div>                </div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">营业时间</label>                    <div class="layui-input-inline">                        <input type="text" class="layui-input" id="test9" readonly="readonly" placeholder=" - " name="do_business_time">                    </div>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">是否推荐</label>                <div class="layui-input-block">                    <input type="radio" name="recommend" value="0" title="否" checked="">                    <input type="radio" name="recommend" value="1" title="是">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">首页显示</label>                <div class="layui-input-block">                    <input type="radio" name="is_home" value="0" title="否" checked="">                    <input type="radio" name="is_home" value="1" title="是">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">服务到期时间</label>                <div class="layui-input-inline">                    <input type="text" name="pastdue" id="date1" required readonly="readonly" lay-verify="required" placeholder="服务到期时间" autocomplete="off" class="layui-input">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">星级</label>                <div class="layui-input-block">                    <div><div id="test4"></div></div>                    <input type="hidden" name="star" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input" id="number">                </div>            </div>            <div class="layui-form-item" id="pics">                <div class="layui-form-label">相册图集</div>                <div class="layui-input-block" style="width: 70%;">                    <div class="layui-upload">                        <button type="button" class="layui-btn layui-btn-primary pull-left" id="slide-pc">选择多图</button>                        <div class="pic-more">                            <ul class="pic-more-upload-list slide-pc-priview" id="slide-pc-priview">                            </ul>                        </div>                    </div>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">超级管理账号</label>                <div class="layui-input-inline">                    <input type="text" name="admin_name"  required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">超级管理密码</label>                <div class="layui-input-inline">                    <input type="password" name="admin_pwd"  required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input">                </div>            </div>            <div class="layui-form-item">                <div class="layui-input-block">                    <button type="button" class="layui-btn" lay-submit="" lay-filter="submit">{:lang('submit')}</button>                    <a href="{:url('index')}" class="layui-btn layui-btn-primary">返回列表</a>                </div>            </div>        </form></div></div></div></div></div>{/block}{block name="js"}<script>var albummoduleid = '{$albummoduleid}';var logomoduleid = '{$logomoduleid}';    layui.use(['form','upload','layedit','laydate','jquery','rate'], function () {        var form = layui.form,            upload = layui.upload,            layedit = layui.layedit,            laydate = layui.laydate,            $ = layui.jquery,            rate = layui.rate;        //自定义验证规则        form.verify({        });        //监听提交        form.on('submit(submit)', function (data) {            // 提交到方法 默认为本身            var loading = layer.load(1, {shade: [0.1, '#fff']});            $.post("", data.field, function (res) {                layer.close(loading);                if (res.code > 0) {                    layer.msg(res.msg, {time: 1800, icon: 1}, function () {                        location.href = res.url;                    });                } else {                    layer.msg(res.msg, {time: 1800, icon: 2});                }            });        });        //监听省份选择        form.on('select(province)', function(data){            var indexGID = data.elem.selectedIndex;            //获取当前选中下拉项的自定义属性值            var dataid = data.elem[indexGID].title;            $('#city').html('<option value="">请选择市/县</option>');            $('#area').html('<option value="">请选择镇区</option>');            $('#street').html('<option value="">请选择街道</option>');            $.ajax( {                url:"{:url('admin/bigshop/getchildarea')}",                data: {parent_id: dataid},                type:'POST',                dataType:'json',                success:function(data1) {                    if (data1.error == 0) {                        $("#city").append(data1.option);                        form.render('select'); //刷新select选择框渲染                    }                }            });        });        form.on('select(city)', function(data){            var indexGID = data.elem.selectedIndex;            //获取当前选中下拉项的自定义属性值            var dataid = data.elem[indexGID].title;            $('#area').html('<option value="">请选择镇区</option>');            $('#street').html('<option value="">请选择街道</option>');            $.ajax( {                url:"{:url('admin/bigshop/getchildarea')}",                data: {parent_id: dataid},                type:'POST',                dataType:'json',                success:function(data1) {                    if (data1.error == 0) {                        $("#area").append(data1.option);                        form.render('select'); //刷新select选择框渲染                    }                }            });        });        //监听省份选择        form.on('select(area)', function(data){            var indexGID = data.elem.selectedIndex;            //获取当前选中下拉项的自定义属性值            var dataid = data.elem[indexGID].title;            $('#street').html('<option value="">请选择街道</option>');            $.ajax( {                url:"{:url('admin/bigshop/getchildarea')}",                data: {parent_id: dataid},                type:'POST',                dataType:'json',                success:function(data1) {                    if (data1.error == 0) {                        $("#street").append(data1.option);                        form.render('select'); //刷新select选择框渲染                    }                }            });        });        //日期        laydate.render({            elem: '#date'        });        laydate.render({            elem: '#date1'        });        //时间范围        laydate.render({            elem: '#test9'            ,type: 'time'            ,range: true        });        //星级        rate.render({            elem: '#test4'            ,value: 5            ,half: true            ,text: true            ,setText: function(value){ //自定义文本的回调                var arrs = {                    '1': '极差'                    ,'2': '差'                    ,'3': '中等'                    ,'4': '好'                    ,'5': '极好'                };                this.span.text(arrs[value]);                $("#number").val(value);            }        })        //商圈logo         upload.render({            elem: '.upload-picture',            url: uploadApi,            data: {                moduleid: logomoduleid,                attachmark: attachmark,                identity: identity,            },            field: 'upfile',            //size: 20000,            exts: 'jpg|png|jpeg',            before: function(obj) {                layer.msg('图片上传中...', {                    icon: 16,                    shade: 0.01,                    time: 0                })            },            done: function(res, index, upload){ //上传后的回调                layer.msg(res.message);                if( res.status == 'success' ){                    //if(res.uploadInfo.attachthumb == ''){                        $('input[name=bigshoplogo]').val(res.uploadInfo.attachurl);                        $('img','.upload-picture').attr('src',res.uploadInfo.attachurl);                    // }else{                    //     $('input[name=shoplogo]').val(res.uploadInfo.attachthumb);                    //     $('img','.upload-picture').attr('src',res.uploadInfo.attachthumb);                    // }                }            }        });        //多图上传        upload.render({            elem: '#slide-pc',             url: uploadApi,            data: {                moduleid: albummoduleid,                attachmark: attachmark,                identity: identity,            },            field: 'upfile',            //size: 100000000000,            exts: 'jpg|png|jpeg|gif',            multiple: true,            before: function(obj) {                layer.msg('图片上传中...', {                    icon: 16,                    shade: 0.01,                    time: 0                })            },            done: function(res) {                layer.close(layer.msg());//关闭上传提示窗口                if(res.status == 'success') {                    $('#slide-pc-priview').append('<li class="item_img"><div class="operate"><i class="toleft layui-icon"></i><i class="toright layui-icon"></i><i  class="close layui-icon"></i></div><img src="' + res.uploadInfo.attachurl + '" class="img" ><input type="hidden" name="headimg[]" value="' + res.uploadInfo.attachurl + '" /></li>');                }else{                    return layer.msg(res.message);                }                            }        });    });    //点击多图上传的X,删除当前的图片    $("body").on("click",".close",function(){        $(this).closest("li").remove();    });    //多图上传点击<>左右移动图片    $("body").on("click",".pic-more ul li .toleft",function(){        var li_index=$(this).closest("li").index();        if(li_index>=1){            $(this).closest("li").insertBefore($(this).closest("ul").find("li").eq(Number(li_index)-1));        }    });    $("body").on("click",".pic-more ul li .toright",function(){        var li_index=$(this).closest("li").index();        $(this).closest("li").insertAfter($(this).closest("ul").find("li").eq(Number(li_index)+1));    });    $("body").on("click",".mapkg",function(){         var dis=$('#g-map').css('display');         if (dis=='block') {            dis=$('#g-map').css('display','none')            $(this).text('打开地图选择')         } else {            dis=$('#g-map').css('display','block')            $(this).text('关闭地图选择')         }    });</script><script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.6&key=a739148df6737cfafd4bc1d9a35d2a1f&plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.CitySearch,AMap.Geolocation,AMap.Geocoder"></script><script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script><script type="text/javascript" src="https://webapi.amap.com/demos/js/liteToolbar.js"></script><script src="https://webapi.amap.com/ui/1.0/main.js"></script><link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/><script type="text/javascript">    var map,addMarker;    var geocoder;    var placeSearch;    var lat = "{$franchisee.latitude|default='39.90923'}";    var lng = "{$franchisee.longitude|default='116.397428'}";    map = new AMap.Map('g-map', {        resizeEnable: true,        center: [lng,lat],        zoom:13,//级别    });    //为地图注册click事件获取鼠标点击出的经纬度坐标    var clickEventListener = map.on('click', function(e) {        $("input[name='m_point']").val(e.lnglat.getLng() + ',' + e.lnglat.getLat());        $("input[name='latitude']").val(e.lnglat.getLat());        $("input[name='longitude']").val(e.lnglat.getLng());        // 创建一个 Marker 实例：        var marker = new AMap.Marker({            position: new AMap.LngLat(e.lnglat.getLng(), e.lnglat.getLat()),   // 经纬度对象，也可以是经纬度构成的一维数组[116.39, 39.9]        });        // 将创建的点标记添加到已有的地图实例：        map.add(marker);        map.on('click', function(e) {            // 移除已创建的 marker            map.remove(marker);        });        var geocoder;        var lnglatXY=new AMap.LngLat(e.lnglat.getLng(),e.lnglat.getLat());        //加载地理编码插件        map.plugin(["AMap.Geocoder"],function(){            geocoder=new AMap.Geocoder({                radius:1000, //以已知坐标为中心点，radius为半径，返回范围内兴趣点和道路信息                extensions: "all"//返回地址描述以及附近兴趣点和道路信息，默认"base"            });            //返回地理编码结果            AMap . event . addListener(geocoder, "complete",geocoder_CallBack);            //逆地理编码            geocoder.getAddress(lnglatXY);        });        //地理编码返回结果展示        function geocoder_CallBack(data){            console.log(data,'kkkkk');            var resultStr="";            //地理编码结果数组            var geocode = new Array();            geocode = data.geocodes;            $("input[name='address']").val(data.regeocode.formattedAddress);        }    });</script>{/block}